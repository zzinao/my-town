{"ast":null,"code":"import _defineProperty from\"/Users/jina/Desktop/\\u1112\\u1161\\u11BC\\u1112\\u116299/sparta-react02/community/my_town-/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";var _handleActions;import{createAction,handleActions}from'redux-actions';import{produce}from'immer';import{setCookie,getCookie,deleteCookie}from'../../shared/Cookies';import{getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,updateProfile,browserSessionPersistence,setPersistence,onAuthStateChanged,signOut}from'firebase/auth';import{auth}from'../../shared/firebase';//action\nvar LOG_OUT='LOG_OUT';var GET_USER='GET_USER';var SET_USER='SET_USER';//action creator\nvar logOut=createAction(LOG_OUT,function(user){return{user:user};});var getUser=createAction(GET_USER,function(user){return{user:user};});var setUser=createAction(SET_USER,function(user){return{user:user};});// initialState\nvar initialState={user:null,is_login:false};// middlewares actions\nvar loginFB=function loginFB(id,pwd){return function(dispatch,getState,_ref){var history=_ref.history;var auth=getAuth();setPersistence(auth,browserSessionPersistence).then(function(res){signInWithEmailAndPassword(auth,id,pwd).then(function(user){dispatch(setUser({user_name:user.user.displayName,id:id,user_profile:'',uid:user.user.uid}));history.push('/');// return signInWithEmailAndPassword(auth, id, pwd)\n// ...\n}).catch(function(error){var errorCode=error.code;var errorMessage=error.message;});});};};var signupFB=function signupFB(id,pwd,user_name){return function(dispatch,getState,_ref2){var history=_ref2.history;var auth=getAuth();createUserWithEmailAndPassword(auth,id,pwd).then(function(userCredential){// Signed in\nvar user=userCredential.user;console.log(user);updateProfile(auth.currentUser,{displayName:user_name}).then(function(){dispatch(setUser({user_name:user_name,id:id,user_profile:'',uid:user.uid}));history.push('/');}).catch(function(error){console.log(error);});// ...\n}).catch(function(error){var errorCode=error.code;var errorMessage=error.message;// ..\n});};};var loginCheckFB=function loginCheckFB(){return function(dispatch,getState,_ref3){var history=_ref3.history;var auth=getAuth();onAuthStateChanged(auth,function(user){if(user){dispatch(setUser({user_name:user.displayName,user_profile:'',id:user.email,uid:user.uid}));history.push('/');}});};};var logoutFB=function logoutFB(){return function(dispatch,getState,_ref4){var history=_ref4.history;auth.signOut().then(function(){dispatch(logOut());history.replace('/');});};};//reducer\nexport default handleActions((_handleActions={},_defineProperty(_handleActions,SET_USER,function(state,action){return produce(state,function(draft){setCookie('is_login','success');draft.user=action.payload.user;draft.is_login=true;});}),_defineProperty(_handleActions,LOG_OUT,function(state,action){return produce(state,function(draft){deleteCookie('is_login');draft.user=null;draft.is_login=false;});}),_defineProperty(_handleActions,GET_USER,function(state,action){return produce(state,function(draft){});}),_handleActions),initialState);//action creator export\nvar actionCreators={logOut:logOut,getUser:getUser,signupFB:signupFB,loginFB:loginFB,loginCheckFB:loginCheckFB,logoutFB:logoutFB};export{actionCreators};","map":{"version":3,"sources":["/Users/jina/Desktop/항해99/sparta-react02/community/my_town-/src/redux/modules/User.js"],"names":["createAction","handleActions","produce","setCookie","getCookie","deleteCookie","getAuth","createUserWithEmailAndPassword","signInWithEmailAndPassword","updateProfile","browserSessionPersistence","setPersistence","onAuthStateChanged","signOut","auth","LOG_OUT","GET_USER","SET_USER","logOut","user","getUser","setUser","initialState","is_login","loginFB","id","pwd","dispatch","getState","history","then","res","user_name","displayName","user_profile","uid","push","catch","error","errorCode","code","errorMessage","message","signupFB","userCredential","console","log","currentUser","loginCheckFB","email","logoutFB","replace","state","action","draft","payload","actionCreators"],"mappings":"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","sourcesContent":["import { createAction, handleActions } from 'redux-actions'\nimport { produce } from 'immer'\n\nimport { setCookie, getCookie, deleteCookie } from '../../shared/Cookies'\n\nimport {\n  getAuth,\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  updateProfile,\n  browserSessionPersistence,\n  setPersistence,\n  onAuthStateChanged,\n  signOut,\n} from 'firebase/auth'\nimport { auth } from '../../shared/firebase'\n\n//action\nconst LOG_OUT = 'LOG_OUT'\nconst GET_USER = 'GET_USER'\nconst SET_USER = 'SET_USER'\n\n//action creator\n\nconst logOut = createAction(LOG_OUT, (user) => ({ user }))\nconst getUser = createAction(GET_USER, (user) => ({ user }))\nconst setUser = createAction(SET_USER, (user) => ({ user }))\n\n// initialState\nconst initialState = {\n  user: null,\n  is_login: false,\n}\n\n// middlewares actions\nconst loginFB = (id, pwd) => {\n  return function (dispatch, getState, { history }) {\n    const auth = getAuth()\n    setPersistence(auth, browserSessionPersistence).then((res) => {\n      signInWithEmailAndPassword(auth, id, pwd)\n        .then((user) => {\n          dispatch(\n            setUser({\n              user_name: user.user.displayName,\n              id: id,\n              user_profile: '',\n              uid: user.user.uid,\n            }),\n          )\n          history.push('/')\n          // return signInWithEmailAndPassword(auth, id, pwd)\n          // ...\n        })\n        .catch((error) => {\n          const errorCode = error.code\n          const errorMessage = error.message\n        })\n    })\n  }\n}\n\nconst signupFB = (id, pwd, user_name) => {\n  return function (dispatch, getState, { history }) {\n    const auth = getAuth()\n    createUserWithEmailAndPassword(auth, id, pwd)\n      .then((userCredential) => {\n        // Signed in\n        const user = userCredential.user\n        console.log(user)\n\n        updateProfile(auth.currentUser, {\n          displayName: user_name,\n        })\n          .then(() => {\n            dispatch(\n              setUser({\n                user_name: user_name,\n                id: id,\n                user_profile: '',\n                uid: user.uid,\n              }),\n            )\n            history.push('/')\n          })\n          .catch((error) => {\n            console.log(error)\n          })\n        // ...\n      })\n\n      .catch((error) => {\n        const errorCode = error.code\n        const errorMessage = error.message\n        // ..\n      })\n  }\n}\n\nconst loginCheckFB = () => {\n  return function (dispatch, getState, { history }) {\n    const auth = getAuth()\n    onAuthStateChanged(auth, (user) => {\n      if (user) {\n        dispatch(\n          setUser({\n            user_name: user.displayName,\n            user_profile: '',\n            id: user.email,\n            uid: user.uid,\n          }),\n        )\n        history.push('/')\n      }\n    })\n  }\n}\n\nconst logoutFB = () => {\n  return function (dispatch, getState, { history }) {\n    auth.signOut().then(() => {\n      dispatch(logOut())\n      history.replace('/')\n    })\n  }\n}\n//reducer\nexport default handleActions(\n  {\n    [SET_USER]: (state, action) =>\n      produce(state, (draft) => {\n        setCookie('is_login', 'success')\n        draft.user = action.payload.user\n        draft.is_login = true\n      }),\n    [LOG_OUT]: (state, action) =>\n      produce(state, (draft) => {\n        deleteCookie('is_login')\n        draft.user = null\n        draft.is_login = false\n      }),\n    [GET_USER]: (state, action) => produce(state, (draft) => {}),\n  },\n  initialState,\n)\n\n//action creator export\nconst actionCreators = {\n  logOut,\n  getUser,\n  signupFB,\n  loginFB,\n  loginCheckFB,\n  logoutFB,\n}\n\nexport { actionCreators }\n"]},"metadata":{},"sourceType":"module"}